<html>
	<head>
		<meta charset="utf-8" />
		<script src="https://code.jquery.com/jquery-1.11.3.js"></script>
		<script src="jst1.js"></script>
		<style>
			.sample {
				border: 1px solid gray;
				padding: 0;
				margin: 0;
				margin-top:10px;
			}
			
			.title {
				background-color: black;
				color: white;
				padding:0;
				margin:0;
			}
			br {
				margin:0
			}
			fieldset{
				margin: 10px 20px 10px 20px;
				border: 1px solid darkgray;
			}
			h1 {
				text-indent: 20px;
			}
			pre{ 
				tab-size:2; 
			}
		</style>
	</head>	
	<body>
		<div class="sample">
			<h1 class="title">Guide</h1>
			<pre>
	Usage:
		var t = new jst(document.getElementById("output"), false); 
		t.render(data, document.getElementById("output"), true);
		
	Class document:
		constructor:
			jst(dom, preserveWhiteSpace);
				dom: dom object / template string
				preserveWhiteSpace: trim textnode. default: false.
				
		method:
			jst.render(data, target, refresh);
				data: the data used for template
				dom: the output target
				refresh: true: refresh mode, false: patch mode. default: false.
				
	List of attributes for template direction in execution order:
		jst-skip                : Skip the processing of this node. Used when the node contains a large third party user control(eg. google map), 
		                          *The processing of the following directions is also skipped.
		jst-begin               : Call javascript function before processing
		jst-if                  : Output the node when the expression is valued true
		jst-repeat              : Repeat the node itself 
		jst-filter              : Filter condition for jst-repeat
		jst-item-begin          : Call javascript function when output the node
		jst-html                : Set the innerHTML property value to the result of the expression
		jst-text                : Set the innerText property value to the result of the expression
        jst-bind                : Add value change listener and binds the value to an object. 
                                  (this is an experimental feature.)
		jst-call                : Execute js function before processing it's child nodes
        jst-recursive           : Skip the processing of the child nodes when the expression is valued false
        jst-control             : User defined controll implementation.(under construction)
        jst-item-end            : Call javascript function after output the node and it's child nodes
		jst-end                 : Call javascript after processing the node and it's child nodes

		*do not use jst-repeat and jst-loop in the same node
		*jst-text will over-write the output of jst-html

		
	Pre-defined varibles for template context:
		$jst    : the jst class object
		$target : the render target
		$data   : refer to the render data
		$ctl    : the current node on processing
	
	Limitation
		The keyword 'var' is not supported in template. eg. {{var i in list}}
		Use {{$data.i in list}} or {{i in list}} instead.
	
	How to write template:
		Template is using pure javascript expression. See the following sample.			

	About DOM object:
		jst add context data to the render target dom object.
			jst_ctx    : the context data($jst, $target, $data)
	
	Advanced usage:
		User defined control &amp; behaivor:
		1. Create your own control &amp; behaivor
		
			simple bi-driectional bind example
		
			html:
				&lt;input type="text" bind="{{myBind('value'}}"&gt;
			js:
				// use jquery
				function myBind(varname){
					var $scope = this;
					var $ctl = $scope.$ctl;
					if(!$($ctl).data("myBind")){ // supress rebind
						$($ctl).data("myBind", true);
						$($ctl).on("input", function(){
							var value = this.value;
							$scope.value(varname, value);
							$scope.dirty($scope.$target);
						});
					}
				}

			user defined control sample
			
			html:
				&lt;div add-on="{{myInput($ctl)}}"&gt;&lt;/div&gt;
				
			js:
				//use jquery
				function myInput($ctl){
					if(!$($ctl).data("myInput")){
						$($ctl).data("myInput", true);
						$($ctl).innerHTML="........";
						$($ctl).on("******", function(){
							//do something
						});
					}
				}
			</pre>
		</div>
		<div name="test" class="sample">
			<h1 class="title">text output</h1>
			<fieldset>
    			<legend>HTML</legend>
				<div name="html">
<div>simple: {{text>1? 1 +"1" : 1}}</div>
<div>same as simple: <span jst-text="{{text}}"></span></div>
<div>raw output:<span jst-html="{{text}}"></span></div>
<div>readable text:<span jst-view="{{text}}"></span></div>
<div>mix with static text:<span jst-text="==={{text + ' Plus alpha'}}==="></span></div>
				</div>
			</fieldset>
			<fieldset>
    			<legend>Data</legend>
				<div name="data">
{
	text: "john smith is <red>tall</red>.\r\nThis is second line.\nThis is thrid line\rThis is forth line."
};
				</div>
			</fieldset>
		</div>		
		
		<div name="test" class="sample">
			<h1 class="title">radio &amp; checkbox &amp; select</h1>
			<fieldset>
    			<legend>HTML</legend>
				<div name="html">
<div>
	<select>
		<option value="1" selected="{{$ctl.value=value}}">apple</option>
		<option value="2" selected="{{$ctl.value=value}}">banana</option>
		<option value="3" selected="{{$ctl.value=value}}">orange</option>
	</select>
</div>
<div>
	<input type="radio" name="gender" value="0" checked="{{$ctl.value=gender}}">male
	<input type="radio" name="gender" value="1" checked="{{$ctl.value=gender}}">female
</div>
<div>
	<input type="checkbox" name="fish" value="1" checked="{{meal.fish==1}}">fish
	<input type="checkbox" name="pork" value="1" checked="{{meal.prok==1}}">pork
	<input type="checkbox" name="beef" value="1" checked="{{meal.beef==1}}">beef
</div>
				</div>
			</fieldset>
			<fieldset>
    			<legend>Data</legend>
				<div name="data">
{
	value: 1,
	gender: 2,
	meal: {
		fish: 0,
		pork: 1,
		beef: 1
	}
};
				</div>
			</fieldset>
		</div>		
		
		<div name="test" class="sample">
			<h1 class="title">expression &amp; others</h1>
			<fieldset>
    			<legend>HTML</legend>
				<div name="html">
<div>
	<input type="text" value="{{text.toUpperCase()}}">
</div>
<div>
	<div style="height: 10px;width:80px;border:{{width}}px;background-color:{{color}}">test</div>
</div>

				</div>
			</fieldset>
			<fieldset>
    			<legend>Data</legend>
				<div name="data">
{
	text: "Hello World!",
	width: 2,
	color: "#ff0000"
};
				</div>
			</fieldset>
		</div>		

		<div name="test" class="sample">
			<h1 class="title">loop &amp; condition</h1>
			<fieldset>
    			<legend>HTML</legend>
				<div name="html">
<div>
	<span jst-if="{{value > 10}}" style="color:red">{{value}}</span>
	<span jst-if="{{value <= 10}}" style="color:blue">{{value}}</span>
</div>
<div>
	<span jst-case="{{value > 10}}" style="color:red">{{value}}</span>
	<span jst-case="{{value <= 10}}" style="color:blue">{{value}}</span>
</div>
<div>
	<ul>
		<li jst-repeat="{{$data.idx=0; idx < list.length; ++ idx}}">{{idx}}:{{list[idx]}}</li>
	</ul>
</div>
<div>
	<ul jst-loop="{{$data.name : cart}}">
		<li>{{name}}:{{cart[name]}}</li>
	</ul>
</div>
<div>
	<div jst-if="{{value > 10}}">
		<div jst-repeat="{{$data.idx=0; idx < 10; ++ idx}}">{{idx}}:{{list[idx]}}</div>
	</div>
</div>
<div>
	<div jst-if="{{value < 10}}" jst-repeat="{{$data.idx=0; idx < 10; ++ idx}}">{{idx}}:{{list[idx]}}</div>
</div>
<div>
	<div jst-if="{{value > 10}}" jst-repeat="{{$data.idx=0; idx < 10; ++ idx}}">{{idx}}==={{list[idx]}}</div>
</div>
<div>
	<div jst-if="{{value < 10}}" jst-repeat="{{$data.idx=0; idx < 10; ++ idx}}" jst-filter="{{idx % 2 == 0}}">{{idx}}:{{list[idx]}}</div>
</div>
<div>
	<div jst-if="{{value < 10}}" jst-repeat="{{$data.idx in list}}" jst-filter="{{idx % 2 == 1}}" jst-txt="{{idx}}:{{list[idx]}}"></div>
</div>
				</div>
			</fieldset>
			<fieldset>
    			<legend>Data</legend>
				<div name="data">
{
	list: ['a', 'b', 'c', 'd'],
	cart: {
		apple: 10,
		banana: 15,
		prange: 30
	},
	value: 7
};
				</div>
			</fieldset>
		</div>	
	</body>	
	<script>

		function html_encode(str)   
		{   
			return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/ /g, "&nbsp;").replace(/\t/g, "&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\'/g, "&#39;").replace(/\"/g, "&quot;").replace(/\n/g, "<br>");   
		}   
		 
		function output(o){
			o.html(html_encode(o.html())); 
		}
		$(document).ready(function(){
			
			$("[name=test").each(function(){
				var o;
				o = $(this).find("[name=html]");
				var html = o.html();
				output(o);				
				var o = $(this).find("[name=data]");
				var data = o.html();
				output(o);
				$(this).append("<fieldset><legend>Output</legend><div name='output'></div></fieldset>");
				$(this).append("<fieldset><legend>Display</legend><div name='display'></div></fieldset>");
				/*
				var d = (new Function('return ' + data.replace(/^\n/g, "")))();
				console.log(d);
				var o = $(this).find("[name=display]");
				var t = new jst(html);
				t.render(d, o, true);
				//o.html(html); //TODO


				var o = $(this).find("[name=output]");
				o.html($(this).find("[name=display]").html());
				output(o);
				*/
			});
			
		})
		
		
	</script>
</html>

